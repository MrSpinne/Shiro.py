dist: trusty
env:
  global:
    - DOCKER_USERNAME=MrSpinne
    - secure: hr8fGe845V1zIEQUwBwL1G2MWux8BEtKMy+aF4x2gA4RD/s0NGxkiCVjZMhxFwHqkTGwnZLHWdcg8ThAMhX2dFyCJ6zFNfippD5aTwVAPq5u40IySAy+hS5r8Sk4fKJOR5nZ5eRQXgHNDpX9tWNY7IWKIQa+6q9DeuOtBHVut7XOG8nD/4ONX5aAFmIr4fx+1/Lfhg5CpfUCvU0BhHbgVWT4fdGEfORnoOQxx18VHT+XKmEI8spgYIeV9IpsEyDbPsJGKpwXUU5tS6v5nNWwBPzo+o5ff4Ckb52DHApZRv4kfomoRSV/k5ACKv+k5l9Sqb0wrlAfqlSokAnzG3HF4DJI0l9yTZaZ4eA7d4JwzZ6IBIo2WV7njPADz4iBmv59M7gawihTzDF8fQwQ0bfNtfKg4aSDJQ7cI7YCC2ufewDFruEsHakSCoKINprcVYN/SPJbV15JJe2PD5q03nXhQJKoW7g+Balr7XDcnFUA1tPrFRGeA0upHivWNx8uThuAS45/eb10oxr9ayzFPVAGuXbLHL+i9cwZFP9b8u1MayGgGLeoGIOgBrd5JHpLn0hAbKaL7zc5TjoBF3a0B9NXd8GfmpYaRfaLr/tXKEQa/LRR8ojVUdW6gLGTdmZzXAJxvP4K4eVQc/LalOsFGWYM29gLP7uLaUPpiL7rBsTxavY=
jobs:
  include:
  - stage: build docker image
    script:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t shiro.py .
    - docker images
    - docker tag latest $DOCKER_USERNAME/shiro.py
    - docker push $DOCKER_USERNAME/shiro.py
  - stage: test
    script: docker run --rm $DOCKER_USERNAME/shiro.py cat hello.txt
  - script: docker run --rm $DOCKER_USERNAME/shiro.py cat hello.txt